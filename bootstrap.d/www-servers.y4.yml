packages:
  - name: nginx
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://github.com/nginx/nginx.git'
      tag: 'release-1.29.3'
      version: '1.29.3'
    tools_required:
      - virtual: pkgconfig-for-target
        triple: x86_64-managarm
    pkgs_required:
      - mlibc
    sources_required:
      - pcre2
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/auto/configure'
        - '--prefix=@SYSROOT_DIR@/usr/local/nginx'
        - '--with-pcre=@THIS_SOURCE_DIR@/../pcre2'
        environ:
          CC: '@OPTION:arch-triple@-gcc'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'DESTDIR=@THIS_COLLECT_DIR@', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'